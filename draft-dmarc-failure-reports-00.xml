<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE rfc SYSTEM "rfc2629-xhtml.ent">
<rfc xmlns:xi="http://www.w3.org/2001/XInclude"
	submissionType="IETF"
	docName="draft-dmarc-failure-reports-00"
	category="std"
	ipr="trust200902"
	updates="" xml:lang="en" symRefs="true" sortRefs="false"
	tocInclude="true" version="3">

	<!-- xml2rfc v2v3 conversion 3.3.0 -->

	<front>
		<title abbrev="DMARC Failure reports">Domain-based Message Authentication, Reporting, and Conformance (DMARC)
	Failure Reporting</title>
		<seriesInfo name="Internet-Draft" value="draft-dmarc-failure-reports-00"/>
		<author initials="S. M." surname="Jones" fullname="Steven M Jones" role="editor">
			<organization/>
			<address>
				<email>smj@crash.com</email>
			</address>
		</author>
		<author initials="A." surname="Vesely" fullname="Alessandro Vesely" role="editor">
			<organization/>
			<address>
				<email>vesely@tana.it</email>
			</address>
		</author>
		<date year="2020" month="October" day="26"/>
		<workgroup>DMARC</workgroup>
		<abstract>
			<t>
	 Domain-based Message Authentication, Reporting, and Conformance
	 (DMARC) is a scalable mechanism by which a mail-originating
	 organization can express domain-level policies and preferences for
	 message validation, disposition, and reporting, that a mail-receiving
	 organization can use to improve mail handling.</t>
			<t>
	 This document descripes Failure Reporting, one of the two kinds of
	 reporting that DMARC provides.</t>
		</abstract>
	</front>
	<middle>
		<section numbered="true" toc="default">
			<name>Failure Reports</name>
			<t>
	 Failure reports are normally generated and sent almost immediately
	 after the Mail Receiver detects a DMARC failure.  Rather than waiting
	 for an aggregate report, these reports are useful for quickly
	 notifying the Domain Owners when there is an authentication failure.
	 Whether the failure is due to an infrastructure problem or the
	 message is inauthentic, failure reports also provide more information
	 about the failed message than is available in an aggregate report.</t>
			<t>
	 These reports SHOULD include any URI(s) from the message that failed
	 authentication.  These reports SHOULD include as much of the message
	 and message header as is reasonable to support the Domain Owner's
	 investigation into what caused the message to fail authentication and
	 track down the sender.</t>
			<t>
	 When a Domain Owner requests failure reports for the purpose of
	 forensic analysis, and the Mail Receiver is willing to provide such
	 reports, the Mail Receiver generates and sends a message using the
	 format described in <xref target="RFC6591" format="default"/>; this document updates that reporting
	 format, as described in <xref target="sect-7.3.1" format="default"/>.</t>
			<t>
	 The destination(s) and nature of the reports are defined by the "ruf"
	 and "fo" tags as defined in <strong>TBD</strong>.</t>
			<t>
	 Where multiple URIs are selected to receive failure reports, the
	 report generator MUST make an attempt to deliver to each of them.</t>
			<t>
	 An obvious consideration is the denial-of-service attack that can be
	 perpetrated by an attacker who sends numerous messages purporting to
	 be from the intended victim Domain Owner but that fail both SPF and
	 DKIM; this would cause participating Mail Receivers to send failure
	 reports to the Domain Owner or its delegate in potentially huge
	 volumes.  Accordingly, participating Mail Receivers are encouraged to
	 aggregate these reports as much as is practical, using the Incidents
	 field of the Abuse Reporting Format (<xref target="RFC5965" format="default"/>).  Various aggregation
	 techniques are possible, including the following:</t>
			<ul spacing="normal">
				<li>only send a report to the first recipient of multi-recipient
			messages;</li>
				<li>store reports for a period of time before sending them, allowing
			detection, collection, and reporting of like incidents;</li>
				<li>apply rate limiting, such as a maximum number of reports per
			minute that will be generated (and the remainder discarded).</li>
			</ul>
			<section anchor="sect-7.3.1" numbered="true" toc="default">
				<name>Reporting Format Update</name>
				<t>
	 Operators implementing this specification also implement an augmented
	 version of <xref target="RFC6591" format="default"/> as follows:</t>
				<ol spacing="normal" type="1">
					<li>
						<t>A DMARC failure report includes the following ARF header fields,
			 with the indicated normative requirement levels:</t>
						<ul spacing="normal">
							<li>Identity-Alignment (REQUIRED; defined below)</li>
							<li>Delivery-Result (OPTIONAL)</li>
							<li>DKIM-Domain, DKIM-Identity, DKIM-Selector (REQUIRED if the
					message was signed by DKIM)</li>
							<li>DKIM-Canonicalized-Header, DKIM-Canonicalized-Body (OPTIONAL
					if the message was signed by DKIM)</li>
							<li>SPF-DNS (REQUIRED)</li>
						</ul>
					</li>
					<li>The "Identity-Alignment" field is defined to contain a comma-
			 separated list of authentication mechanism names that produced an
			 aligned identity, or the keyword "none" if none did.  ABNF:</li>
				</ol>
				<sourcecode type="abnf" name=""><![CDATA[
  id-align     = "Identity-Alignment:" [CFWS]
                 ( "none" /
                 dmarc-method *( [CFWS] "," [CFWS] dmarc-method ) )
                 [CFWS]

  dmarc-method = ( "dkim" / "spf" )
  ; each may appear at most once in an id-align
]]></sourcecode>
				<ol spacing="normal" type="1">
					<li>Authentication Failure Type "dmarc" is defined, which is to be
			 used when a failure report is generated because some or all of
			 the authentication mechanisms failed to produce aligned
			 identifiers.  Note that a failure report generator MAY also
			 independently produce an AFRF message for any or all of the
			 underlying authentication methods.</li>
				</ol>
			</section>
		</section>
	</middle>
	<back>
		<references>
			<name>References</name>
			<references>
				<name>Normative References</name>
				<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6591.xml"/>
			</references>
			<references>
				<name>Informative References</name>
				<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5965.xml"/>
			</references>
		</references>
		<section anchor="sect-b.2.3" numbered="true" toc="default">
			<name>Per-Message Failure Reports Directed to Third Party</name>
				<t>
	 The Domain Owner from the previous example is maintaining the same
	 policy but now wishes to have a third party receive and process the
	 per-message failure reports.  Again, not all Receivers will honor
	 this request, but those that do may implement additional checks to
	 validate that the third party wishes to receive the failure reports
	 for this domain.</t>
				<t>
	 The Domain Owner needs to alter its policy record from Appendix B.2.2
	 as follows:</t>
				<ul spacing="normal">
					<li>Per-message failure reports should be sent via email to the
			address "auth-reports@thirdparty.example.net" ("ruf=mailto:auth-reports@thirdparty.example.net")</li>
				</ul>
				<t>
	 The DMARC policy record might look like this when retrieved using a
	 common command-line tool (the output shown would appear on a single
	 line but is wrapped here for publication):</t>
				<sourcecode name=""><![CDATA[
  % dig +short TXT _dmarc.example.com.
  "v=DMARC1; p=none; rua=mailto:dmarc-feedback@example.com;
  ruf=mailto:auth-reports@thirdparty.example.net"
]]></sourcecode>
				<t>
	 To publish such a record, the DNS administrator for the Domain Owner
	 might create an entry like the following in the appropriate zone file
	 (following the conventional zone file format):</t>
				<sourcecode name=""><![CDATA[
  ; DMARC record for the domain example.com

  _dmarc IN TXT ( "v=DMARC1; p=none; "
                  "rua=mailto:dmarc-feedback@example.com; "
                  "ruf=mailto:auth-reports@thirdparty.example.net" )
]]></sourcecode>
				<t>
	 Because the address used in the "ruf" tag is outside the
	 Organizational Domain in which this record is published, conforming
	 Receivers will implement additional checks as described in
	 Section 7.1 of this document.  In order to pass these additional
	 checks, the third party will need to publish an additional DNS record
	 as follows:</t>
				<ul spacing="normal">
					<li>Given the DMARC record published by the Domain Owner at
			"_dmarc.example.com", the DNS administrator for the third party
			will need to publish a TXT resource record at
			"example.com._report._dmarc.thirdparty.example.net" with the value
			"v=DMARC1;".</li>
				</ul>
				<t>
	 The resulting DNS record might look like this when retrieved using a
	 common command-line tool (the output shown would appear on a single
	 line but is wrapped here for publication):</t>
				<sourcecode name=""><![CDATA[
  % dig +short TXT example.com._report._dmarc.thirdparty.example.net
  "v=DMARC1;"
]]></sourcecode>
				<t>
	 To publish such a record, the DNS administrator for example.net might
	 create an entry like the following in the appropriate zone file
	 (following the conventional zone file format):</t>
				<sourcecode name="" ><![CDATA[
  ; zone file for thirdparty.example.net
  ; Accept DMARC failure reports on behalf of example.com

  example.com._report._dmarc   IN   TXT    "v=DMARC1;"
]]></sourcecode>
				<t>
	 Intermediaries and other third parties should refer to <strong>TBD</strong>
	 for the full details of this mechanism.</t>
		</section>
	</back>
</rfc>
